name: ChatOps Help
on:
  repository_dispatch:
    types: [help-command]
permissions:
  issues: write
  pull-requests: write
jobs:
  help:
    runs-on: ubuntu-latest
    steps:
      - name: Post Help Message
        uses: actions/github-script@v7
        with:
          script: |
            const payload = context.payload.client_payload;
            const issueNumber = payload.github.payload.issue?.number || payload.github.payload.pull_request?.number;
            
            if (!issueNumber) {
              core.setFailed('Could not determine issue/PR number');
              return;
            }
            
            const helpMessage = `## ðŸ¤– ChatOps Commands

Available commands for this repository:

### PR Management
- \`/approve\` - Mark PR as approved
- \`/lgtm\` - Add "lgtm" label (Looks Good To Me)
- \`/hold\` - Prevent PR from being merged
- \`/unhold\` - Remove hold

### Labels
- \`/label <name>\` - Add a label (e.g., \`/label kind/bug\`)
- \`/remove-label <name>\` - Remove a label

### Assignment
- \`/assign [@user]\` - Assign to yourself or someone else
- \`/unassign [@user]\` - Remove assignment
- \`/cc @user\` - Request review from user

### Testing
- \`/retest\` - Re-run CI tests

### Lifecycle
- \`/close\` - Close this issue/PR
- \`/reopen\` - Reopen this issue/PR

### Help
- \`/help\` - Show this message

---
ðŸ“– See [ChatOps Documentation](.github/CHATOPS.md) for more details.
Valid labels are defined in [\`.prowlabels.yaml\`](.prowlabels.yaml).`;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: helpMessage
            });
